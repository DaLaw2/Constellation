# Constellation - 核心需求文件

## 專案定位
個人資料管理工具，解決多維度分類困境的資料夾與檔案標籤系統。

## 使用情境與痛點

### 實際使用場景
管理大量圖片、影片、遊戲等資料夾時，需要多維度分類：
- **語言**: 日文 / 英文 / 中文
- **作品**: 特定作品名稱
- **作者**: 創作者名稱
- **屬性**: 全彩 / 單行本 / 原創 / 同人

### 傳統資料夾結構的困境

**單一維度限制**
```
方案A - 按語言分/
  ├─ 日文/
  ├─ 英文/
  └─ 中文/
     └─ 某作品/  ← 無法知道作者、屬性

方案B - 按作者分/
  ├─ 作者A/
  └─ 作者B/
     └─ 某作品/  ← 無法知道語言、屬性
```

無法實現：「日文 + 全彩 + 某作者」這類多維度查詢。

### 現有方案痛點

**TagSpaces**
- 修改檔名或產生 sidecar 檔案，污染目錄
- 資料夾移動時標籤容易遺失

**Tabbles**
- 僅 Windows，付費，UI 老舊

**Eagle**
- 必須匯入檔案，破壞原有組織結構
- 無法直接操作原始檔案

**Directory Opus / Path Finder**
- 需取代系統檔案管理器，昂貴複雜

**筆記工具 (Obsidian/Notion)**
- 只能建立參考系統，無法直接操作檔案
- 需手動維護路徑

**macOS Finder Tags**
- 僅 macOS，標籤資訊易遺失

## Constellation 核心價值

### 1. 真正非侵入
- 不改檔名、不改資料夾名
- 不產生任何額外檔案在目標目錄
- 標籤集中存於獨立 SQLite 資料庫

### 2. 多維度標籤系統
- **標籤分組**: 語言、作品、作者、屬性等不同類別
- **多標籤支援**: 單一項目可擁有多個標籤
- **組合查詢**: AND/OR/NOT 邏輯運算
- **標籤顏色編碼**: 不同分組使用不同顏色

### 3. 智能路徑追蹤
- 使用 Windows USN Journal 監控檔案系統
- 自動偵測資料夾/檔案重新命名或移動
- 即時同步路徑變更到資料庫

### 4. 靈活標記工作流程
- **手動標記**: 瀏覽時隨手標記，無需全盤掃描
- **標籤範本**: 快速套用常用標籤組合
- **自動完成**: 輸入時自動建議已存在的標籤值

### 5. 整合式檔案瀏覽器
- 內建檔案瀏覽器，無需依賴系統檔案總管
- 即時顯示標籤資訊
- 多種檢視模式（詳細資料/大圖示）
- 縮圖預覽支援（圖片、影片、資料夾）

### 6. 非遞迴標籤邏輯
- 標籤只標記在資料夾/檔案本身
- 預設不遞迴顯示子項目
- 搜尋只返回被標記的項目
- 需要遞迴時可選擇性開啟

## 技術棧

### 平台與框架
- **目標平台**: Windows 10+ 專用
- **應用框架**: Tauri 2.x
- **後端語言**: Rust
- **前端渲染**: WebView2 (Chromium-based)
- **前端框架**: Vue

### 資料與監控
- **資料庫**: SQLite
- **檔案系統監控**: Windows USN Journal API
- **並發處理**: Async/await (Tokio)

## 核心功能模組

### 1. 檔案瀏覽器
- 樹狀目錄導航
- 檔案/資料夾列表顯示
- 多種檢視模式切換
- 路徑列與快速搜尋

### 2. 標籤管理系統
- **標籤分組管理**
  - 建立/編輯/刪除標籤分組
  - 分組顏色設定
  - 分組內標籤管理
  
- **標籤 CRUD 操作**
  - 新增/編輯/刪除標籤
  - 標籤值自動完成與建議
  - 避免重複標籤（如「作者A」vs「作者 A」）

- **標籤範本**
  - 建立常用標籤組合
  - 快速套用到項目

- **標籤統計與概覽**
  - 各標籤使用次數統計
  - 分組統計視圖
  - 找出標記不完整的項目

### 3. 標記與關聯管理
- **單一標記**: 選擇項目後編輯標籤
- **快速篩選介面**: 勾選標籤即時顯示結果
- **標籤顯示**: 
  - 詳細資料模式：標籤欄位（可排序）
  - 大圖示模式：標籤顯示在檔名下方
- **標籤過多處理**: 截斷顯示（例如：日文, 作者A... +3）

### 4. 搜尋與查詢
- **即時搜尋**: 輸入後立即顯示結果
- **標籤組合查詢**: AND/OR/NOT 邏輯運算
- **標籤篩選面板**: 左側勾選標籤篩選
- **結果顯示選項**:
  - 混合顯示（資料夾+檔案）
  - 分開顯示（資料夾 / 檔案分類）

### 5. 檔案系統監控
- 監控已標記項目的路徑變更
- 使用 USN Journal 偵測重新命名/移動
- 自動更新資料庫中的路徑
- 準確率目標 > 99%

### 6. 預覽與縮圖生成
- **資料夾縮圖**: 
  - 顯示資料夾內第一個圖片檔案
  - 可指定特定圖片作為縮圖
  
- **影片縮圖**: 
  - 類似檔案總管的靜態縮圖
  - 不需要播放功能
  
- **快取管理**: 
  - LRU 快取策略
  - 快取大小限制

### 7. 排序與顯示
- 按名稱、修改時間、大小、標籤排序
- 按標籤分組顯示（可選）
- 詳細資料 / 大圖示 / 超大圖示模式

## 使用者介面設計

### 主視窗佈局
```
┌─────────────────────────────────────────────────────────┐
│ Constellation    Settings | About              [-][□][×]│
├──────────┬──────────────────────────────────────────────┤
│          │  📍 C:\我的收藏\漫畫\          [⊞詳細][⊟圖示] │
│ [🗂️][🏷️]│  🔍 搜尋...                                   │
│          │  ─────────────────────────────────────────── │
│  (左側)  │                                               │
│  內容區  │  (右側內容區 - 依據檢視模式不同)              │
│          │                                               │
└──────────┴──────────────────────────────────────────────┘
```

### 左側面板 - 雙模式切換

**模式 1: 🗂️ 檔案瀏覽器**
- 樹狀目錄結構
- 可展開/收合
- 支援多磁碟機

**模式 2: 🏷️ 標籤管理**
- 標籤分組顯示
- 每個標籤顯示使用次數
- 可點擊標籤進行篩選
- 新增標籤/管理分組功能

### 右側檢視模式

**詳細資料模式**
```
名稱              │ 修改日期    │ 大小   │ 標籤
──────────────────┼────────────┼────────┼─────────────────
📁 某作品A/       │ 2025/01/15 │ 2.3 GB │ 日文, 作者A... +2
🎬 影片001.mp4   │ 2025/01/12 │ 450 MB │ 日文, 原創
```

**大圖示/超大圖示模式**
```
┌─────────┐  ┌─────────┐
│ [縮圖]  │  │ [縮圖]  │
│         │  │         │
│某作品A/ │  │影片001  │
│日文,作者A│  │日文,原創│
│全彩...+1│  │         │
└─────────┘  └─────────┘
```

## 開發階段規劃

### Phase 1: MVP 基礎建設
- 專案架構建立（Tauri + Rust + Vue）
- SQLite 資料庫設計與實作
  - 標籤表、分組表、關聯表
  - 索引策略
- 基本 UI 框架
  - 雙欄佈局
  - 檔案瀏覽器（樹狀 + 列表）
  - 標籤管理面板
- 標籤 CRUD 操作
- 檔案/資料夾標記功能
- 基本搜尋與篩選

### Phase 2: 進階功能
- 標籤分組系統
- 標籤範本功能
- 自動完成與建議
- 快速篩選介面
- 標籤統計與概覽
- 檢視模式切換（詳細資料 / 大圖示）
- 標籤欄位排序功能

### Phase 3: 預覽與監控
- 縮圖生成系統
  - 圖片縮圖
  - 影片縮圖
  - 資料夾縮圖
- 快取管理機制
- USN Journal 檔案系統監控
- 路徑變更自動更新

### Phase 4: 優化與完善
- 效能優化
  - 資料庫查詢優化
  - UI 虛擬滾動
  - 快取策略調整
- 錯誤處理完善
- 測試覆蓋
- 使用者體驗優化

## 目標規模與效能指標

### 使用規模
- **預期標記數量**: 
  - 資料夾: 10,000
  - 檔案: 100,000
  - 總計: 110,000 項目

- **標籤數量**: 
  - 標籤分組: ~10 個
  - 標籤總數: ~500 個
  - 平均每項目標籤數: 3-5 個

### 效能指標
- **搜尋效能**: 
  - 簡單查詢回應時間 < 50ms
  - 複雜查詢（多標籤組合）< 200ms
  
- **UI 回應**: 
  - 操作回應時間 < 16ms (60 FPS)
  - 檔案列表滾動流暢
  
- **路徑追蹤**: 
  - 變更偵測準確率 > 99%
  - 更新延遲 < 1s
  
- **資源佔用**: 
  - 記憶體佔用 < 150MB
  - 縮圖快取 < 10GB
  
- **使用者體驗**: 
  - 初次使用 5 分鐘內上手
  - 標記單一項目 < 10 秒

## 非功能性需求

### 可靠性
- 資料庫定期備份機制
- 路徑追蹤失敗時的恢復策略
- 標籤資料完整性檢查

### 可維護性
- 模組化架構
- 清晰的錯誤訊息與日誌
- 設定檔與資料庫分離

### 可擴展性
- 預留自訂欄位空間
- 支援未來新增標籤類型
- 匯入/匯出功能（未來階段）

### 安全性
- 資料庫加密（可選）
- 防止 SQL Injection
- 敏感路徑過濾（系統目錄）

## 已確認的設計決策

### ✅ 確定採用
- Tauri 2.x + Rust + Vue 技術棧
- Windows 專用（USN Journal）
- SQLite 資料庫
- 內建檔案瀏覽器
- 標籤非遞迴邏輯（預設）
- 手動標記工作流程（無全盤掃描）
- 智能路徑追蹤（USN Journal）
- 標籤欄位可排序
- 標籤過多時截斷顯示

### ❌ 不包含
- 批次操作功能
- 快捷鍵操作
- 跨平台支援（僅 Windows）
- 自動標記/AI 分類（Phase 1-2 不含）
- 雲端同步
